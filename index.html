<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Friends Fund Tracker</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- SheetJS -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
  }
  h1 { text-align: center; }
  .card {
    background: white;
    padding: 15px;
    margin: 15px auto;
    max-width: 900px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  select, input, button {
    padding: 7px;
    margin: 5px;
    font-size: 14px;
  }
  button {
    background: #1976d2;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button.delete { background: #d32f2f; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }
  .status.paid { color: green; font-weight: bold; }
  .status.partial { color: orange; font-weight: bold; }
  .status.unpaid { color: red; font-weight: bold; }
  .summary { background: #e8f5e9; }
  @media (max-width:600px){
    table { display:block; overflow-x:auto; }
  }

  /* Watermark Style */

  .watermark {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 12px;
  color: rgba(0,0,0,0.45);
  pointer-events: auto;
  z-index: 999;
  user-select: none;
  text-align: center;
}
  /*.watermark {
    position: fixed;
    bottom: 8px;
    right: 12px;
    font-size: 12px;
    color: rgba(0,0,0,0.45);
    pointer-events: auto; /* Allow interaction with only the info icon */
  /*  z-index: 999;
    user-select: none;
  }*/

  .watermark strong {
    color: rgba(25,118,210,0.7);
    font-weight: 600;
  }

  /* Info Icon Style */
  .info-icon {
    cursor: pointer;
    margin-left: 5px;
    font-size: 18px;
    color: rgba(25,118,210,0.7);
    transition: color 0.3s ease;
  }

  .info-icon:hover {
    color: rgba(0,0,0,0.7);
  }

  /* Tooltip Style (Info box above the icon) */
  .info-box {
    display: none;
    position: absolute;
    bottom: 25px; /* Position just above the icon */
    right: 0;
    background-color: rgba(0, 0, 0, 0.75);
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 1000;
    transition: opacity 0.2s ease;
  }

  /* Show info box when mouse is over the icon */
  .info-icon:hover + .info-box {
    display: block;
  }

</style>
</head>

<body>

<h1>üí∞ Monthly Fund Tracker</h1>

<div class="card">
  <select id="monthSelect" onchange="render()">
    <option>January</option><option>February</option><option>March</option>
    <option>April</option><option>May</option><option>June</option>
    <option>July</option><option>August</option><option>September</option>
    <option>October</option><option>November</option><option>December</option>
  </select>

  <select id="yearSelect" onchange="render()"></select>

  <button onclick="exportToExcel()">‚¨á Export to Excel</button>

  <!-- Save and Import buttons -->
  <button onclick="saveToFile()">üíæ Save Data</button>
  <input type="file" id="importFile" onchange="importFromFile(event)" style="display:none">
  <button onclick="document.getElementById('importFile').click()">üìÇ Import Data</button>
</div>

<div class="card">
  <table id="statusTable"></table>
</div>

<div class="card summary">
  Total Collected: ‚Çπ<span id="total">0</span> |
  Pending Members: <span id="pending">0</span>
</div>

<div class="card">
  <h3>Spend Details</h3>
  <table id="spendTable"></table>
  <input id="spendDesc" placeholder="Description">
  <input id="spendAmount" type="number" placeholder="‚Çπ">
  <button onclick="addSpend()">Add</button>
</div>

<div class="card summary">
  Year Collected: ‚Çπ<span id="yearTotal">0</span> |
  Spent: ‚Çπ<span id="yearSpent">0</span> |
  Balance: ‚Çπ<span id="yearBalance">0</span>
</div>

<div class="card"><canvas id="barChart"></canvas></div>
<div class="card"><canvas id="lineChart"></canvas></div>

<script>
const MEMBERS = ["Narendra","Rajesh","Ratikanta","Samir","Sunil","Santosh","Kiran","Chinmya"];
const FULL_AMOUNT = 500;

let data = JSON.parse(localStorage.getItem("fundData")) || {};
let spendData = JSON.parse(localStorage.getItem("spendData")) || {};

const monthSelect = document.getElementById("monthSelect");
const yearSelect = document.getElementById("yearSelect");

for (let y = 2025; y <= 2035; y++) {
  yearSelect.innerHTML += `<option>${y}</option>`;
}

const today = new Date();
monthSelect.selectedIndex = today.getMonth();
yearSelect.value = today.getFullYear();

function getKey() {
  return monthSelect.value + "-" + yearSelect.value;
}
function getYearKey(year, month) {
  return month + "-" + year;
}

function addPayment(name) {
  const input = document.getElementById("input_" + name);
  let value = Number(input.value);
  if (value <= 0) return;

  const key = getKey();
  data[key] = data[key] || {};
  const alreadyPaid = data[key][name] || 0;
  data[key][name] = Math.min(FULL_AMOUNT, alreadyPaid + value);

  localStorage.setItem("fundData", JSON.stringify(data));
  render();
}

function addSpend() {
  const desc = spendDesc.value.trim();
  const amt = Number(spendAmount.value);
  if (!desc || amt <= 0) return;

  const key = getKey();
  spendData[key] = spendData[key] || [];
  spendData[key].push({ desc, amount: amt });

  localStorage.setItem("spendData", JSON.stringify(spendData));
  spendDesc.value = "";
  spendAmount.value = "";
  render();
}

let barChart, lineChart;

function render() {
  const key = getKey();
  let totalCollected = 0;
  let pendingCount = 0;

  statusTable.innerHTML =
    `<tr><th>Name</th><th>Paid</th><th>Status</th><th>Action</th></tr>`;

  MEMBERS.forEach(name => {
    const paid = data[key]?.[name] || 0;
    totalCollected += paid;

    let status = "unpaid";
    if (paid >= FULL_AMOUNT) status = "paid";
    else if (paid > 0) status = "partial";

    if (paid < FULL_AMOUNT) pendingCount++;

    statusTable.innerHTML += `
      <tr>
        <td>${name}</td>
        <td>‚Çπ${paid}</td>
        <td class="status ${status}">${status}</td>
        <td>${paid >= FULL_AMOUNT ? "‚Äî" :
          `<input id="input_${name}" type="number" value="${FULL_AMOUNT - paid}">
           <button onclick="addPayment('${name}')">Add</button>`}
        </td>
      </tr>`;
  });

  document.getElementById("total").textContent = totalCollected;
  document.getElementById("pending").textContent = pendingCount;

  const spendTable = document.getElementById("spendTable");
  spendTable.innerHTML =
    `<tr><th>Description</th><th>Amount</th></tr>`;
  (spendData[key] || []).forEach(s => {
    spendTable.innerHTML += `<tr><td>${s.desc}</td><td>‚Çπ${s.amount}</td></tr>`;
  });

  let yearTotalAmount = 0;
  let yearSpentAmount = 0;

  [...monthSelect.options].forEach(m => {
    const k = getYearKey(yearSelect.value, m.text);
    if (data[k]) yearTotalAmount += Object.values(data[k]).reduce((a, b) => a + b, 0);
    if (spendData[k]) yearSpentAmount += spendData[k].reduce((a, s) => a + s.amount, 0);
  });

  document.getElementById("yearTotal").textContent = yearTotalAmount;
  document.getElementById("yearSpent").textContent = yearSpentAmount;
  document.getElementById("yearBalance").textContent = yearTotalAmount - yearSpentAmount;

  const months = [...monthSelect.options].map(o => o.text);
  const collected = months.map(m => {
    const k = getYearKey(yearSelect.value, m);
    return data[k] ? Object.values(data[k]).reduce((a, b) => a + b, 0) : 0;
  });
  const spent = months.map(m => {
    const k = getYearKey(yearSelect.value, m);
    return spendData[k] ? spendData[k].reduce((a, s) => a + s.amount, 0) : 0;
  });

  if (barChart) barChart.destroy();
  barChart = new Chart(document.getElementById("barChart"), {
    type: "bar",
    data: {
      labels: months,
      datasets: [
        { label: "Collected", data: collected, backgroundColor: "#4caf50" },
        { label: "Spent", data: spent, backgroundColor: "#f44336" }
      ]
    }
  });

  let cumulative = [], c = 0;
  collected.forEach((v, i) => {
    c += v - spent[i];
    cumulative.push(c);
  });

  if (lineChart) lineChart.destroy();
  lineChart = new Chart(document.getElementById("lineChart"), {
    type: "line",
    data: {
      labels: months,
      datasets: [{
        label: "Balance",
        data: cumulative,
        borderColor: "#1976d2",
        fill: true
      }]
    }
  });
}

function exportToExcel() {
  const year = yearSelect.value;
  const wb = XLSX.utils.book_new();

  let totalCollected = 0, totalSpent = 0;
  let pendingSet = new Set();
  const currentMonth = today.getMonth();

  [...monthSelect.options].forEach((m, idx) => {
    if (idx > currentMonth) return;
    const k = getYearKey(year, m.text);

    MEMBERS.forEach(n => {
      const p = data[k]?.[n] || 0;
      totalCollected += p;
      if (p < FULL_AMOUNT) pendingSet.add(n);
    });

    if (spendData[k])
      totalSpent += spendData[k].reduce((a, s) => a + s.amount, 0);
  });

  XLSX.utils.book_append_sheet(wb,
    XLSX.utils.aoa_to_sheet([["Year", year], ["Total Collected", totalCollected], ["Total Spent", totalSpent], ["Balance", totalCollected - totalSpent], ["Pending Members", pendingSet.size], ["Pending Names", [...pendingSet].join(", ")]]),
    "Summary"
  );

  [...monthSelect.options].forEach(m => {
    const k = getYearKey(year, m.text);
    let rows = [["Member", "Paid", "Status"]]; 
    let sum = 0;

    MEMBERS.forEach(n => {
      const p = data[k]?.[n] || 0;
      sum += p;
      rows.push([n, p, p >= FULL_AMOUNT ? "Paid" : p > 0 ? "Partial" : "Unpaid"]);
    });

    rows.push([]); 
    rows.push(["TOTAL", sum, ""]);
    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), m.text);
  });

  XLSX.writeFile(wb, `Fund_Report_${year}.xlsx`);
}

// Save to JSON functionality
function saveToFile() {
  const dataToSave = { data, spendData };
  const blob = new Blob([JSON.stringify(dataToSave)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "fundTrackerData.json";
  a.click();
  URL.revokeObjectURL(url);
}

// Import from JSON functionality
function importFromFile(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const importedData = JSON.parse(e.target.result);
      if (importedData.data && importedData.spendData) {
        data = importedData.data;
        spendData = importedData.spendData;

        localStorage.setItem("fundData", JSON.stringify(data));
        localStorage.setItem("spendData", JSON.stringify(spendData));
        render();
      } else {
        alert("Invalid file format");
      }
    } catch (error) {
      alert("Failed to read the file: " + error.message);
    }
  };
  reader.readAsText(file);
}

render();

</script>

<div class="watermark">
  Powered by <strong>8 Crazy Friends</strong>
  <span class="info-icon" id="infoIcon">‚ÑπÔ∏è</span>
  <div class="info-box">Designed and Developed by Narendra Panda</div>
</div>

</body>
</html>


